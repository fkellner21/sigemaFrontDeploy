<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
/>
<link rel="stylesheet" href="modelo.component.css" />

<div class="titulo text-center my-1">Listado de modelos</div>

<div class="row me-0">
    <div class="row pe-0 justify-content-between align-items-center">
        <div class="col-4">
            <mat-form-field class="w-100">
                <mat-label>Buscar</mat-label>
                <input matInput (keyup)="applyFilter($event)" #input />
            </mat-form-field>
        </div>
        <div
            class="col-4 pe-0 text-end"
            *ngIf="
                authservice.getRol() == 'ROLE_ADMINISTRADOR' ||
                authservice.getRol() == 'ROLE_BRIGADA'
            "
        >
            <button (click)="setNew()" class="btn btn-dark">
                Nuevo modelo
            </button>
        </div>
    </div>
    <div>
        <table
            mat-table
            [dataSource]="dataSource"
            class="mat-elevation-z8 table table-striped table-hover"
        >
            <!-- Name Column -->
            <ng-container matColumnDef="Anio">
                <th
                    mat-header-cell
                    *matHeaderCellDef
                    class="bg-dark text-white"
                >
                    AÃ±o
                </th>
                <td mat-cell *matCellDef="let element">{{ element.anio }}</td>
            </ng-container>

            <!-- Name Column -->
            <ng-container matColumnDef="Marca">
                <th
                    mat-header-cell
                    *matHeaderCellDef
                    class="bg-dark text-white"
                >
                    Marca
                </th>
                <td mat-cell *matCellDef="let element">
                    {{ element.marca.nombre }}
                </td>
            </ng-container>
            <!-- Name Column -->
            <ng-container matColumnDef="Modelo">
                <th
                    mat-header-cell
                    *matHeaderCellDef
                    class="bg-dark text-white"
                >
                    Modelo
                </th>
                <td mat-cell *matCellDef="let element">{{ element.modelo }}</td>
            </ng-container>
            <!-- Name Column -->
            <ng-container matColumnDef="Capacidad">
                <th
                    mat-header-cell
                    *matHeaderCellDef
                    class="bg-dark text-white"
                >
                    Capacidad
                </th>
                <td mat-cell *matCellDef="let element" class="text-center">
                    {{ element.capacidad }}
                </td>
            </ng-container>
            <!-- Name Column -->
            <ng-container matColumnDef="Tipo">
                <th
                    mat-header-cell
                    *matHeaderCellDef
                    class="bg-dark text-white"
                >
                    Tipo
                </th>
                <td mat-cell *matCellDef="let element">
                    {{ element.tipoEquipo.codigo }}
                </td>
            </ng-container>

            <!-- Frecuencias -->
            <ng-container matColumnDef="Mantenimiento">
                <th
                    mat-header-cell
                    *matHeaderCellDef
                    class="bg-dark text-white"
                >
                    Frecuencia de Mantenimiento
                </th>
                <td mat-cell *matCellDef="let element">
                    <button
                        class="btn btn-light"
                        (click)="abrirModalService(element)"
                        title="Ver service standard"
                    >
                        <i class="bi bi-wrench"></i>
                    </button>
                    <ng-container [ngSwitch]="element.unidadMedida">
                        <span *ngSwitchCase="'HT'">
                            {{ element.frecuenciaUnidadMedida }} HT |
                            {{ element.frecuenciaTiempo }} Meses
                        </span>
                        <span *ngSwitchCase="'KMs'">
                            {{ element.frecuenciaUnidadMedida }} KMs |
                            {{ element.frecuenciaTiempo }} Meses
                        </span>
                        <span *ngSwitchDefault>-</span>
                    </ng-container>
                </td>
            </ng-container>

            <!-- Equipo Column -->
            <ng-container matColumnDef="VerEquipos">
                <th
                    mat-header-cell
                    *matHeaderCellDef
                    class="bg-dark text-white"
                >
                    Equipos
                </th>
                <td mat-cell *matCellDef="let element">
                    <button
                        class="btn btn-dark"
                        (click)="abrirModalEquipos(element)"
                        title="Ver Equipos"
                    >
                        <i class="bi bi-bus-front-fill"></i>
                    </button>
                </td>
            </ng-container>
            <!-- Symbol Column -->
            <ng-container matColumnDef="VerRepuestos">
                <th
                    mat-header-cell
                    *matHeaderCellDef
                    class="bg-dark text-white"
                >
                    Repuestos
                </th>
                <td mat-cell *matCellDef="let element">
                    <button
                        class="btn btn-dark"
                        (click)="abrirModalRepuestos(element)"
                        title="Ver Repuestos"
                    >
                        <i class="bi bi-tools"></i>
                    </button>
                </td>
            </ng-container>
            <!-- Symbol Column -->
            <ng-container matColumnDef="VerLubricantes">
                <th
                    mat-header-cell
                    *matHeaderCellDef
                    class="bg-dark text-white"
                >
                    Lubricantes
                </th>
                <td mat-cell *matCellDef="let element">
                    <button
                        class="btn btn-dark"
                        (click)="abrirModalLubricantes(element)"
                        title="Ver Lubricantes"
                    >
                        <i class="bi bi-moisture"> </i>
                    </button>
                </td>
            </ng-container>
            <!-- Symbol Column -->
            <ng-container matColumnDef="VerDocumentos">
                <th
                    mat-header-cell
                    *matHeaderCellDef
                    class="bg-dark text-white"
                >
                    Documentos
                </th>
                <td mat-cell *matCellDef="let element">
                    <button
                        class="btn btn-dark"
                        (click)="abrirModalDocumentos(element)"
                        title="Ver Documentos"
                    >
                        <i class="bi bi-file-richtext"></i>
                    </button>
                </td>
            </ng-container>
            <!-- Symbol Column -->
            <ng-container matColumnDef="Modificar">
                <th
                    mat-header-cell
                    *matHeaderCellDef
                    class="bg-dark text-white"
                ></th>
                <td
                    mat-cell
                    *matCellDef="let element"
                    class="d-flex w-100 justify-content-center align-items-center"
                >
                    <button
                        *ngIf="
                            authservice.getRol() == 'ROLE_ADMINISTRADOR' ||
                            authservice.getRol() == 'ROLE_BRIGADA'
                        "
                        class="btn btn-dark"
                        (click)="setSelectedModelo(element)"
                        title="Modificar"
                    >
                        <i class="bi bi-pencil"></i>
                    </button>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

            <!-- Row shown when there is no matching data. -->
            <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell" colspan="10">
                    No existen datos para la consulta "{{ input.value }}"
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="text-center my-3" *ngIf="isLoadingModelos">
    <div class="spinner-border text-dark" role="status">
        <span class="visually-hidden">Cargando...</span>
    </div>
</div>

@if(open){
<div class="abrir-modal animacion fadeIn">
    <modelo-form
        [modeloEquipo]="modeloSelected"
        [marcas]="marcas"
        [tiposEquipo]="tipos"
        (newModeloEventEmitter)="addModelo($event)"
        (openEventEmitter)="setOpen()"
    />
</div>
} @if(abrirDocs){
<div class="modal" tabindex="-1" style="display: block">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    Documentos del modelo {{ modeloSelected.marca.nombre }}-{{
                        modeloSelected.modelo
                    }}
                </h5>
                <button class="btn-close" (click)="cerrarModal()"></button>
            </div>
            <div class="modal-body">
                <documento-form
                    [modeloId]="modeloSeleccionadoId"
                ></documento-form>
            </div>
        </div>
    </div>
</div>
} @if(abrirRepuestos){
<div class="modal" tabindex="-1" style="display: block">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    Repuestos del modelo {{ modeloSelected.marca.nombre }}-{{
                        modeloSelected.modelo
                    }}
                </h5>
                <button
                    class="btn-close"
                    (click)="cerrarModalRepuestos()"
                ></button>
            </div>
            <div class="modal-body">
                <lista-repuestos-de-modelo
                    [modeloId]="modeloSeleccionadoId"
                    [tipoRepuesto]="tipoRepuestoSeleccionado"
                ></lista-repuestos-de-modelo>
            </div>
        </div>
    </div>
</div>
} @if(abrirLubricantes){
<div class="modal" tabindex="-1" style="display: block">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    Lubricantes del modelo {{ modeloSelected.marca.nombre }}-{{
                        modeloSelected.modelo
                    }}
                </h5>
                <button
                    class="btn-close"
                    (click)="cerrarModalLubricantes()"
                ></button>
            </div>
            <div class="modal-body">
                <lista-repuestos-de-modelo
                    [modeloId]="modeloSeleccionadoId"
                    [tipoRepuesto]="tipoRepuestoSeleccionado"
                ></lista-repuestos-de-modelo>
            </div>
        </div>
    </div>
</div>
} @if(abrirEquipos){
<div class="modal" tabindex="-1" style="display: block">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    Equipos del modelo {{ modeloSelected.marca.nombre }}-{{
                        modeloSelected.modelo
                    }}
                </h5>
                <button
                    class="btn-close"
                    (click)="cerrarModalEquipos()"
                ></button>
            </div>
            <div class="modal-body">
                <lista-equipos-de-modelo
                    [idModelo]="modeloSeleccionadoId"
                ></lista-equipos-de-modelo>
            </div>
        </div>
    </div>
</div>
}
<sevice-modelo
    *ngIf="abrirService"
    [modeloEquipo]="modeloSelected"
    (cerrarFormulario)="cerrarModalService()"
></sevice-modelo>
